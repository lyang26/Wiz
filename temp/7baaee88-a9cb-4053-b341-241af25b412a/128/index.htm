<!DOCTYPE HTML><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode">
<title>AjaxFileUpload总结</title>
    <!--mark |wiz_custom_css| for wizeditor replace it-->
<link rel="stylesheet"  name="wiz_tmp_editor_style" href="index_files/fonts_7.css"><style id="wiz_custom_css">html, body {            font-size: 15px;        }        body {            font-family: Helvetica, 'Hiragino Sans GB', '微软雅黑', 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;            line-height: 1.6;            margin: 0;            padding: 20px 15px;            padding: 1.33rem 1rem;        }        h1, h2, h3, h4, h5, h6 {            margin: 20px 0 10px;            margin: 1.33rem 0 0.667rem;            padding: 0;            font-weight: bold;        }        h1 {            font-size: 21px;            font-size: 1.4rem;        }        h2 {            font-size: 20px;            font-size: 1.33rem;        }        h3 {            font-size: 18px;            font-size: 1.2rem;        }        h4 {            font-size: 17px;            font-size: 1.13rem;        }        h5 {            font-size: 15px;            font-size: 1rem;        }        h6 {            font-size: 15px;            font-size: 1rem;            color: #777777;            margin: 1rem 0;        }        div, p, ul, ol, dl, li {            margin: 0;        }        blockquote, table, pre, code {            margin: 8px 0;        }        ul, ol {            padding-left: 32px;            padding-left: 2.13rem;        }        blockquote {            padding: 0 12px;            padding: 0 0.8rem;        }        blockquote > :first-child {            margin-top: 0;        }        blockquote > :last-child {            margin-bottom: 0;        }        img {            border: 0;            max-width: 100%;            height: auto !important;            margin: 2px 0;        }        table {            border-collapse: collapse;            border: 1px solid #bbbbbb;        }        td, th {            padding: 4px 8px;            border-collapse: collapse;            border: 1px solid #bbbbbb;			        }        @media only screen and (-webkit-max-device-width: 1024px), only screen and (-o-max-device-width: 1024px), only screen and (max-device-width: 1024px), only screen and (-webkit-min-device-pixel-ratio: 3), only screen and (-o-min-device-pixel-ratio: 3), only screen and (min-device-pixel-ratio: 3) {            html, body {                font-size: 17px;            }            body {                line-height: 1.7;                padding: 0.75rem 0.9375rem;                color: #353c47;            }            h1 {                font-size: 2.125rem;            }            h2 {                font-size: 1.875rem;            }            h3 {                font-size: 1.625rem;            }            h4 {                font-size: 1.375rem;            }            h5 {                font-size: 1.125rem;            }            h6 {                color: inherit;            }            ul, ol {                padding-left: 2.5rem;            }            blockquote {                padding: 0 0.9375rem;            }        }</style><style id="wiz_tmp_editor_style" wiz_style= "unsave">html, body {    font-size: 15px;}body {    font-family: Helvetica, 'Hiragino Sans GB', 微软雅黑, 'Microsoft YaHei UI', SimSun, SimHei, arial, sans-serif;    line-height: 1.6;    color: ;    background-color: ;    margin: 0;    padding: 20px 15px;    padding: 1.33rem 1rem;}img{    max-width: 100%;}</style><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\utils.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\localize.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\core\wizEditorForPc.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\WizNote\WizTools\htmleditor\editorHelper.js" wiz_style="unsave" charset="utf-8"></script><script type="text/javascript" src="file:///D:\Wizs\templates\WizTemplate.js" wiz_style="unsave" charset="utf-8"></script></head>

<body spellcheck="false" ><p>　　AjaxFileUpload总结</p><p>　　1、AjaxFileUpload功能</p><p>　　实现异步上传文件的jQuery插件</p><p>　　2、 实现方法</p><p>　　1.引入AjaxFileUpload插件相关的js</p><p>　　2.js代码调用ajax上传方法</p><p>　　$.ajaxFileUpload({</p><p>　　url: /control/method,</p><p>　　type: 'post',</p><p>　　secureuri: false, //一般设置为false</p><p>　　fileElementId: 'file', // 上传文件的id、name属性名</p><p>　　dataType: 'text', //返回值类型，一般设置为json、application/json</p><p>　　elementIds: elementIds, //传递参数到服务器</p><p>　　success: function(data, status){</p><p>　　alert(data);</p><p>　　},</p><p>　　error: function(data, status, e){</p><p>　　alert(e);</p><p>　　}</p><p>　　});</p><p>　　3、&nbsp; 请求参数说明：</p><p>　　options参数说明：</p><p>　　url　　　　　　　　　　 &nbsp;上传处理程序地址。</p><p>　　fileElementId　　　　　 &nbsp;需要上传的文件域的ID，即的ID。</p><p>　　secureuri　　　　　　　 是否启用安全提交，默认为false。</p><p>　　dataType　　　　　　　 服务器返回的数据类型。可以为xml,script,json,html。如果不填写，jQuery会自动判断。</p><p>　　success　　　　　　　　提交成功后自动执行的处理函数，参数data就是服务器返回的数据。</p><p>　　error　　　　　　　　　 提交失败自动执行的处理函数。</p><p>　　data 　　　　　　　　　&nbsp;自定义参数。这个东西比较有用，当有数据是与上传的图片相关的时候，这个东西就要用到了。</p><p>　　type 　　　　　　　　　 &nbsp;当要提交自定义参数时，这个参数要设置成post</p><p>　　4、实现原理：</p><p>　　创建隐藏的表单和iframe然后用JS去提交，获得返回值</p><p>　　5、源码说明</p><p>　　</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">jQuery.extend({&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; createUploadIframe: function (id, uri) {//id为当前系统时间字符串，uri是外部传入的json对象的一个参数</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; //create frame</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var frameId = 'jUploadFrame' + id; //给iframe添加一个独一无二的id</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var iframeHtml = '&lt;iframe id="' + frameId + '" name="' + frameId + '" style="position:absolute; top:-9999px; left:-9999px"'; //创建iframe元素</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (window.ActiveXObject) {//判断浏览器是否支持ActiveX控件</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (typeof uri == 'boolean') {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; iframeHtml += ' src=\'#\'" /&gt;';</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(iframeHtml).appendTo(document.body); //将动态iframe追加到body中</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; return jQuery('#' + frameId).get(0); //返回iframe对象</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; },</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; createUploadForm: function (id, fileElementId, data) {//id为当前系统时间字符串，fileElementId为页面&lt;input type='file' /&gt;的id，data的值需要根据传入json的键来决定</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; //create form&nbsp; &nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var formId = 'jUploadForm' + id; //给form添加一个独一无二的id</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var fileId = 'jUploadFile' + id; //给&lt;input type='file' /&gt;添加一个独一无二的id</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var form = jQuery('&lt;form&nbsp; action="" method="POST" name="' + formId + '" id="' + formId + '" enctype="multipart/form-data" &gt;&lt;/form&gt;'); //创建form元素</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (data) {//通常为false</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (var i in data) {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery('&lt;input type="hidden" name="' + i + '" value="' + data[i] + '" /&gt;').appendTo(form); //根据data的内容，创建隐藏域，这部分我还不知道是什么时候用到。估计是传入json的时候，如果默认传一些参数的话要用到。</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var oldElement = jQuery('#' + fileElementId); //得到页面中的&lt;input type='file' /&gt;对象</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var newElement = jQuery(oldElement).clone(); //克隆页面中的&lt;input type='file' /&gt;对象</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(oldElement).attr('id', fileId); //修改原对象的id</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(oldElement).before(newElement); //在原对象前插入克隆对象</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(oldElement).appendTo(form); //把原对象插入到动态form的结尾处</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; //set attributes</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).css('position', 'absolute'); //给动态form添加样式，使其浮动起来，</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).css('top', '-1200px');</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).css('left', '-1200px');</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).appendTo('body'); //把动态form插入到body中</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; return form;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; },</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; ajaxFileUpload: function (s) {//这里s是个json对象，传入一些ajax的参数</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // TODO introduce global settings, allowing the client to modify them for all requests, not only timeout&nbsp; &nbsp; &nbsp; &nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; s = jQuery.extend({}, jQuery.ajaxSettings, s); //此时的s对象是由jQuery.ajaxSettings和原s对象扩展后的对象</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var id = new Date().getTime(); //取当前系统时间，目的是得到一个独一无二的数字</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var form = jQuery.createUploadForm(id, s.fileElementId, (typeof (s.data) == 'undefined' ? false : s.data)); //创建动态form</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var io = jQuery.createUploadIframe(id, s.secureuri); //创建动态iframe</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var frameId = 'jUploadFrame' + id; //动态iframe的id</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var formId = 'jUploadForm' + id; //动态form的id</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // Watch for a new set of requests</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (s.global &amp;&amp; !jQuery.active++) {//当jQuery开始一个ajax请求时发生</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.event.trigger("ajaxStart"); //触发ajaxStart方法</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var requestDone = false; //请求完成标志</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // Create the request object</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var xml = {};</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (s.global)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.event.trigger("ajaxSend", [xml, s]); //触发ajaxSend方法</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // Wait for a response to come back</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var uploadCallback = function (isTimeout) {//回调函数</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var io = document.getElementById(frameId); //得到iframe对象</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (io.contentWindow) {//动态iframe所在窗口对象是否存在</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml.responseText = io.contentWindow.document.body ? io.contentWindow.document.body.innerHTML : null;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml.responseXML = io.contentWindow.document.XMLDocument ? io.contentWindow.document.XMLDocument : io.contentWindow.document;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if (io.contentDocument) {//动态iframe的文档对象是否存在</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml.responseText = io.contentDocument.document.body ? io.contentDocument.document.body.innerHTML : null;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml.responseXML = io.contentDocument.document.XMLDocument ? io.contentDocument.document.XMLDocument : io.contentDocument.document;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (e) {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.handleError(s, xml, null, e);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (xml || isTimeout == "timeout") {//xml变量被赋值或者isTimeout == "timeout"都表示请求发出，并且有响应</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; requestDone = true; //请求完成</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var status;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = isTimeout != "timeout" ? "success" : "error"; //如果不是“超时”，表示请求成功</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Make sure that the request was successful or notmodified</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (status != "error") {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // process the data (runs the xml through httpData regardless of callback)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var data = jQuery.uploadHttpData(xml, s.dataType); //根据传送的type类型，返回json对象，此时返回的data就是后台操作后的返回结果</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If a local callback was specified, fire it and pass it the data</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (s.success)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s.success(data, status); //执行上传成功的操作</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Fire the global callback</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (s.global)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.event.trigger("ajaxSuccess", [xml, s]);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.handleError(s, xml, status);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (e) {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = "error";</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.handleError(s, xml, status, e);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The request was completed</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (s.global)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.event.trigger("ajaxComplete", [xml, s]);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Handle the global AJAX counter</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (s.global &amp;&amp; ! --jQuery.active)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.event.trigger("ajaxStop");</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Process result</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (s.complete)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s.complete(xml, status);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(io).unbind();//移除iframe的事件处理程序</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setTimeout(function () {//设置超时时间</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(io).remove();//移除动态iframe</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).remove();//移除动态form</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } catch (e) {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.handleError(s, xml, null, e);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, 100)</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xml = null</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // Timeout checker</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (s.timeout &gt; 0) {//超时检测</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; setTimeout(function () {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Check to see if the request is still happening</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!requestDone) uploadCallback("timeout");//如果请求仍未完成，就发送超时信号</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }, s.timeout);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; try {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var form = jQuery('#' + formId);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).attr('action', s.url);//传入的ajax页面导向url</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).attr('method', 'POST');//设置提交表单方式</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).attr('target', frameId);//返回的目标iframe，就是创建的动态iframe</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (form.encoding) {//选择编码方式</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).attr('encoding', 'multipart/form-data');</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).attr('enctype', 'multipart/form-data');</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery(form).submit();//提交form表单</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; } catch (e) {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.handleError(s, xml, null, e);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; jQuery('#' + frameId).load(uploadCallback); //ajax 请求从服务器加载数据，同时传入回调函数</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; return { abort: function () { } };</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; },</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; uploadHttpData: function (r, type) {</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; var data = !type;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; data = type == "xml" || data ? r.responseXML : r.responseText;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // If the type is "script", eval it in global context</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (type == "script")</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery.globalEval(data);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // Get the JavaScript object, if JSON is used.</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (type == "json")</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval("data = " + data);</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; // evaluate scripts within html</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; if (type == "html")</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; jQuery("&lt;div&gt;").html(data).evalScripts();</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; &nbsp; &nbsp; return data;</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">&nbsp; &nbsp; }</p><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; line-height: 22.4px; text-align: justify; background-color: rgb(250, 250, 252);">})</p><br><div style="color:gray"><small>来源：&nbsp;<a href="http://www.linuxidc.com/Linux/2014-09/106413.htm">http://www.linuxidc.com/Linux/2014-09/106413.htm</a></small></div><p><iframe id="' + frameId + '" name="' + frameId + '" style="position:absolute; top:-9999px; left:-9999px" ';="" 创建iframe元素<="" p="">
&lt;p&gt;　　if (window.ActiveXObject) {//判断浏览器是否支持ActiveX控件&lt;/p&gt;
&lt;p&gt;　　if (typeof uri == 'boolean') {&lt;/p&gt;
&lt;p&gt;　　iframeHtml += ' src="D:\'#/'&quot;" /&gt;';&lt;/p&gt;
&lt;p&gt;　　jQuery(iframeHtml).appendTo(document.body); //将动态iframe追加到body中&lt;/p&gt;
&lt;p&gt;　　return jQuery('#' + frameId).get(0); //返回iframe对象&lt;/p&gt;
&lt;p&gt;　　},&lt;/p&gt;
&lt;p&gt;　　createUploadForm: function (id, fileElementId, data) {//id为当前系统时间字符串，fileElementId为页面&lt;input type='file' /&gt;的id，data的值需要根据传入json的键来决定&lt;/p&gt;
&lt;p&gt;　　//create form&lt;/p&gt;
&lt;p&gt;　　var formId = 'jUploadForm' + id; //给form添加一个独一无二的id&lt;/p&gt;
&lt;p&gt;　　var fileId = 'jUploadFile' + id; //给&lt;input type='file' /&gt;添加一个独一无二的id&lt;/p&gt;
&lt;p&gt;　　var form = jQuery('&lt;form&nbsp; action="" method="POST" name="' + formId + '" id="' + formId + '" enctype="multipart/form-data" &gt;&lt;/form&gt;'); //创建form元素&lt;/p&gt;
&lt;p&gt;　　if (data) {//通常为false&lt;/p&gt;
&lt;p&gt;　　for (var i in data) {&lt;/p&gt;
&lt;p&gt;　　jQuery('&lt;input type="hidden" name="' + i + '" value="' + data[i] + '" /&gt;').appendTo(form); //根据data的内容，创建隐藏域，这部分我还不知道是什么时候用到。估计是传入json的时候，如果默认传一些参数的话要用到。&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　var oldElement = jQuery('#' + fileElementId); //得到页面中的&lt;input type='file' /&gt;对象&lt;/p&gt;
&lt;p&gt;　　var newElement = jQuery(oldElement).clone(); //克隆页面中的&lt;input type='file' /&gt;对象&lt;/p&gt;
&lt;p&gt;　　jQuery(oldElement).attr('id', fileId); //修改原对象的id&lt;/p&gt;
&lt;p&gt;　　jQuery(oldElement).before(newElement); //在原对象前插入克隆对象&lt;/p&gt;
&lt;p&gt;　　jQuery(oldElement).appendTo(form); //把原对象插入到动态form的结尾处&lt;/p&gt;
&lt;p&gt;　　//set attributes&lt;/p&gt;
&lt;p&gt;　　jQuery(form).css('position', 'absolute'); //给动态form添加样式，使其浮动起来，&lt;/p&gt;
&lt;p&gt;　　jQuery(form).css('top', '-1200px');&lt;/p&gt;
&lt;p&gt;　　jQuery(form).css('left', '-1200px');&lt;/p&gt;
&lt;p&gt;　　jQuery(form).appendTo('body'); //把动态form插入到body中&lt;/p&gt;
&lt;p&gt;　　return form;&lt;/p&gt;
&lt;p&gt;　　},&lt;/p&gt;
&lt;p&gt;　　ajaxFileUpload: function (s) {//这里s是个json对象，传入一些ajax的参数&lt;/p&gt;
&lt;p&gt;　　// TODO introduce global settings, allowing the client to modify them for all requests, not only timeout&lt;/p&gt;
&lt;p&gt;　　s = jQuery.extend({}, jQuery.ajaxSettings, s); //此时的s对象是由jQuery.ajaxSettings和原s对象扩展后的对象&lt;/p&gt;
&lt;p&gt;　　var id = new Date().getTime(); //取当前系统时间，目的是得到一个独一无二的数字&lt;/p&gt;
&lt;p&gt;　　var form = jQuery.createUploadForm(id, s.fileElementId, (typeof (s.data) == 'undefined' ? false : s.data)); //创建动态form&lt;/p&gt;
&lt;p&gt;　　var io = jQuery.createUploadIframe(id, s.secureuri); //创建动态iframe&lt;/p&gt;
&lt;p&gt;　　var frameId = 'jUploadFrame' + id; //动态iframe的id&lt;/p&gt;
&lt;p&gt;　　var formId = 'jUploadForm' + id; //动态form的id&lt;/p&gt;
&lt;p&gt;　　// Watch for a new set of requests&lt;/p&gt;
&lt;p&gt;　　if (s.global &amp;&amp; !jQuery.active++) {//当jQuery开始一个ajax请求时发生&lt;/p&gt;
&lt;p&gt;　　jQuery.event.trigger("ajaxStart"); //触发ajaxStart方法&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　var requestDone = false; //请求完成标志&lt;/p&gt;
&lt;p&gt;　　// Create the request object&lt;/p&gt;
&lt;p&gt;　　var xml = {};&lt;/p&gt;
&lt;p&gt;　　if (s.global)&lt;/p&gt;
&lt;p&gt;　　jQuery.event.trigger("ajaxSend", [xml, s]); //触发ajaxSend方法&lt;/p&gt;
&lt;p&gt;　　// Wait for a response to come back&lt;/p&gt;
&lt;p&gt;　　var uploadCallback = function (isTimeout) {//回调函数&lt;/p&gt;
&lt;p&gt;　　var io = document.getElementById(frameId); //得到iframe对象&lt;/p&gt;
&lt;p&gt;　　try {&lt;/p&gt;
&lt;p&gt;　　if (io.contentWindow) {//动态iframe所在窗口对象是否存在&lt;/p&gt;
&lt;p&gt;　　xml.responseText = io.contentWindow.document.body ? io.contentWindow.document.body.innerHTML : null;&lt;/p&gt;
&lt;p&gt;　　xml.responseXML = io.contentWindow.document.XMLDocument ? io.contentWindow.document.XMLDocument : io.contentWindow.document;&lt;/p&gt;
&lt;p&gt;　　} else if (io.contentDocument) {//动态iframe的文档对象是否存在&lt;/p&gt;
&lt;p&gt;　　xml.responseText = io.contentDocument.document.body ? io.contentDocument.document.body.innerHTML : null;&lt;/p&gt;
&lt;p&gt;　　xml.responseXML = io.contentDocument.document.XMLDocument ? io.contentDocument.document.XMLDocument : io.contentDocument.document;&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　} catch (e) {&lt;/p&gt;
&lt;p&gt;　　jQuery.handleError(s, xml, null, e);&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　if (xml || isTimeout == "timeout") {//xml变量被赋值或者isTimeout == "timeout"都表示请求发出，并且有响应&lt;/p&gt;
&lt;p&gt;　　requestDone = true; //请求完成&lt;/p&gt;
&lt;p&gt;　　var status;&lt;/p&gt;
&lt;p&gt;　　try {&lt;/p&gt;
&lt;p&gt;　　status = isTimeout != "timeout" ? "success" : "error"; //如果不是“超时”，表示请求成功&lt;/p&gt;
&lt;p&gt;　　// Make sure that the request was successful or notmodified&lt;/p&gt;
&lt;p&gt;　　if (status != "error") {&lt;/p&gt;
&lt;p&gt;　　// process the data (runs the xml through httpData regardless of callback)&lt;/p&gt;
&lt;p&gt;　　var data = jQuery.uploadHttpData(xml, s.dataType); //根据传送的type类型，返回json对象，此时返回的data就是后台操作后的返回结果&lt;/p&gt;
&lt;p&gt;　　// If a local callback was specified, fire it and pass it the data&lt;/p&gt;
&lt;p&gt;　　if (s.success)&lt;/p&gt;
&lt;p&gt;　　s.success(data, status); //执行上传成功的操作&lt;/p&gt;
&lt;p&gt;　　// Fire the global callback&lt;/p&gt;
&lt;p&gt;　　if (s.global)&lt;/p&gt;
&lt;p&gt;　　jQuery.event.trigger("ajaxSuccess", [xml, s]);&lt;/p&gt;
&lt;p&gt;　　} else&lt;/p&gt;
&lt;p&gt;　　jQuery.handleError(s, xml, status);&lt;/p&gt;
&lt;p&gt;　　} catch (e) {&lt;/p&gt;
&lt;p&gt;　　status = "error";&lt;/p&gt;
&lt;p&gt;　　jQuery.handleError(s, xml, status, e);&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　// The request was completed&lt;/p&gt;
&lt;p&gt;　　if (s.global)&lt;/p&gt;
&lt;p&gt;　　jQuery.event.trigger("ajaxComplete", [xml, s]);&lt;/p&gt;
&lt;p&gt;　　// Handle the global AJAX counter&lt;/p&gt;
&lt;p&gt;　　if (s.global &amp;&amp; ! --jQuery.active)&lt;/p&gt;
&lt;p&gt;　　jQuery.event.trigger("ajaxStop");&lt;/p&gt;
&lt;p&gt;　　// Process result&lt;/p&gt;
&lt;p&gt;　　if (s.complete)&lt;/p&gt;
&lt;p&gt;　　s.complete(xml, status);&lt;/p&gt;
&lt;p&gt;　　jQuery(io).unbind();//移除iframe的事件处理程序&lt;/p&gt;
&lt;p&gt;　　setTimeout(function () {//设置超时时间&lt;/p&gt;
&lt;p&gt;　　try {&lt;/p&gt;
&lt;p&gt;　　jQuery(io).remove();//移除动态iframe&lt;/p&gt;
&lt;p&gt;　　jQuery(form).remove();//移除动态form&lt;/p&gt;
&lt;p&gt;　　} catch (e) {&lt;/p&gt;
&lt;p&gt;　　jQuery.handleError(s, xml, null, e);&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　}, 100)&lt;/p&gt;
&lt;p&gt;　　xml = null&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　// Timeout checker&lt;/p&gt;
&lt;p&gt;　　if (s.timeout &gt; 0) {//超时检测&lt;/p&gt;
&lt;p&gt;　　setTimeout(function () {&lt;/p&gt;
&lt;p&gt;　　// Check to see if the request is still happening&lt;/p&gt;
&lt;p&gt;　　if (!requestDone) uploadCallback("timeout");//如果请求仍未完成，就发送超时信号&lt;/p&gt;
&lt;p&gt;　　}, s.timeout);&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　try {&lt;/p&gt;
&lt;p&gt;　　var form = jQuery('#' + formId);&lt;/p&gt;
&lt;p&gt;　　jQuery(form).attr('action', s.url);//传入的ajax页面导向url&lt;/p&gt;
&lt;p&gt;　　jQuery(form).attr('method', 'POST');//设置提交表单方式&lt;/p&gt;
&lt;p&gt;　　jQuery(form).attr('target', frameId);//返回的目标iframe，就是创建的动态iframe&lt;/p&gt;
&lt;p&gt;　　if (form.encoding) {//选择编码方式&lt;/p&gt;
&lt;p&gt;　　jQuery(form).attr('encoding', 'multipart/form-data');&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　else {&lt;/p&gt;
&lt;p&gt;　　jQuery(form).attr('enctype', 'multipart/form-data');&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　jQuery(form).submit();//提交form表单&lt;/p&gt;
&lt;p&gt;　　} catch (e) {&lt;/p&gt;
&lt;p&gt;　　jQuery.handleError(s, xml, null, e);&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　jQuery('#' + frameId).load(uploadCallback); //ajax 请求从服务器加载数据，同时传入回调函数&lt;/p&gt;
&lt;p&gt;　　return { abort: function () { } };&lt;/p&gt;
&lt;p&gt;　　},&lt;/p&gt;
&lt;p&gt;　　uploadHttpData: function (r, type) {&lt;/p&gt;
&lt;p&gt;　　var data = !type;&lt;/p&gt;
&lt;p&gt;　　data = type == "xml" || data ? r.responseXML : r.responseText;&lt;/p&gt;
&lt;p&gt;　　// If the type is "script", eval it in global context&lt;/p&gt;
&lt;p&gt;　　if (type == "script")&lt;/p&gt;
&lt;p&gt;　　jQuery.globalEval(data);&lt;/p&gt;
&lt;p&gt;　　// Get the JavaScript object, if JSON is used.&lt;/p&gt;
&lt;p&gt;　　if (type == "json")&lt;/p&gt;
&lt;p&gt;　　eval("data = " + data);&lt;/p&gt;
&lt;p&gt;　　// evaluate scripts within html&lt;/p&gt;
&lt;p&gt;　　if (type == "html")&lt;/p&gt;
&lt;p&gt;　　jQuery("&lt;div&gt;").html(data).evalScripts();&lt;/p&gt;
&lt;p&gt;　　return data;&lt;/p&gt;
&lt;p&gt;　　}&lt;/p&gt;
&lt;p&gt;　　})&lt;/p&gt;
&lt;p&gt;　　来源：&nbsp;http://www.linuxidc.com/Linux/2014-09/106413.htm&lt;/p&gt;
</iframe></p></body></html>